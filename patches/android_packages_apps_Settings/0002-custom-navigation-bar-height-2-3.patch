From 63906996e880620d6aed0ebbe8d4deaa5f5bc306 Mon Sep 17 00:00:00 2001
From: Konsta <konsta09@gmail.com>
Date: Fri, 2 Jan 2015 16:44:48 +0200
Subject: [PATCH 2/3] custom navigation bar height (2/3)

Change-Id: Ie5156ff97a71aba29245ab2df3a7bd4988e4a223
---
 res/values/cm_arrays.xml                     | 21 +++++++++++++++++++++
 res/values/cm_strings.xml                    | 10 ++++++++++
 res/xml/button_settings.xml                  |  9 +++++++++
 src/com/android/settings/ButtonSettings.java | 17 +++++++++++++++++
 4 files changed, 57 insertions(+)

diff --git a/res/values/cm_arrays.xml b/res/values/cm_arrays.xml
index d70c1ba..26d054b 100644
--- a/res/values/cm_arrays.xml
+++ b/res/values/cm_arrays.xml
@@ -15,6 +15,27 @@
      limitations under the License.
 -->
 <resources>
+    <!--- Navigation bar height -->
+    <string-array name="nav_buttons_height_entries" translatable="false">
+        <item>@string/navigation_bar_height_48</item>
+        <item>@string/navigation_bar_height_44</item>
+        <item>@string/navigation_bar_height_40</item>
+        <item>@string/navigation_bar_height_36</item>
+        <item>@string/navigation_bar_height_32</item>
+        <item>@string/navigation_bar_height_28</item>
+        <item>@string/navigation_bar_height_24</item>
+    </string-array>
+
+    <string-array name="nav_buttons_height_values" translatable="false">
+        <item>48</item>
+        <item>44</item>
+        <item>40</item>
+        <item>36</item>
+        <item>32</item>
+        <item>28</item>
+        <item>24</item>
+    </string-array>
+
     <!-- Arrays for root access capability -->
     <string-array name="root_access_entries" translatable="false">
         <item>@string/root_access_none</item>
diff --git a/res/values/cm_strings.xml b/res/values/cm_strings.xml
index 4578323..8de73e4 100644
--- a/res/values/cm_strings.xml
+++ b/res/values/cm_strings.xml
@@ -276,6 +276,16 @@
     <string name="navigation_bar_arrow_keys_summary">Display left and right cursor buttons while typing. Overrides IME switcher.</string>
     <string name="navigation_bar_recents_title">Recents long press action</string>
 
+    <!-- Navigation bar height -->
+    <string name="navigation_bar_height">Button height</string>
+    <string name="navigation_bar_height_48">48dp (default)</string>
+    <string name="navigation_bar_height_44">44dp</string>
+    <string name="navigation_bar_height_40">40dp</string>
+    <string name="navigation_bar_height_36">36dp</string>
+    <string name="navigation_bar_height_32">32dp</string>
+    <string name="navigation_bar_height_28">28dp</string>
+    <string name="navigation_bar_height_24">24dp</string>
+
     <!-- Notification light dialogs -->
     <string name="edit_light_settings">Edit light settings</string>
     <string name="pulse_speed_title">Pulse length and speed</string>
diff --git a/res/xml/button_settings.xml b/res/xml/button_settings.xml
index 9a85b6f..9d2e299 100644
--- a/res/xml/button_settings.xml
+++ b/res/xml/button_settings.xml
@@ -33,6 +33,15 @@
         android:key="navigation_bar_category"
         android:title="@string/navigation_bar_category" >
 
+        <ListPreference
+            android:key="nav_buttons_height"
+            android:dialogTitle="@string/navigation_bar_height"
+            android:title="@string/navigation_bar_height"
+            android:entries="@array/nav_buttons_height_entries"
+            android:entryValues="@array/nav_buttons_height_values"
+            android:defaultValue="48"
+            android:persistent="false" />
+
         <com.android.settings.cyanogenmod.CMSystemSettingSwitchPreference
             android:key="navigation_bar_left"
             android:title="@string/navigation_bar_left_title"
diff --git a/src/com/android/settings/ButtonSettings.java b/src/com/android/settings/ButtonSettings.java
index 30ac090..deeb503 100644
--- a/src/com/android/settings/ButtonSettings.java
+++ b/src/com/android/settings/ButtonSettings.java
@@ -77,6 +77,7 @@ public class ButtonSettings extends SettingsPreferenceFragment implements
     private static final String DISABLE_NAV_KEYS = "disable_nav_keys";
     private static final String KEY_NAVIGATION_BAR_LEFT = "navigation_bar_left";
     private static final String KEY_NAVIGATION_RECENTS_LONG_PRESS = "navigation_recents_long_press";
+    private static final String KEY_NAVIGATION_HEIGHT = "nav_buttons_height";
     private static final String KEY_POWER_END_CALL = "power_end_call";
     private static final String KEY_HOME_ANSWER_CALL = "home_answer_call";
     private static final String KEY_VOLUME_MUSIC_CONTROLS = "volbtn_music_controls";
@@ -130,6 +131,7 @@ public class ButtonSettings extends SettingsPreferenceFragment implements
     private SwitchPreference mCameraSleepOnRelease;
     private SwitchPreference mCameraLaunch;
     private ListPreference mVolumeKeyCursorControl;
+    private ListPreference mNavButtonsHeight;
     private SwitchPreference mVolumeWakeScreen;
     private SwitchPreference mVolumeMusicControls;
     private SwitchPreference mSwapVolumeButtons;
@@ -211,6 +213,9 @@ public class ButtonSettings extends SettingsPreferenceFragment implements
 
         mNavigationPreferencesCat = (PreferenceCategory) findPreference(CATEGORY_NAVBAR);
 
+        // Navigation bar height
+        mNavButtonsHeight = (ListPreference) findPreference(KEY_NAVIGATION_HEIGHT);
+
         // Navigation bar left
         mNavigationBarLeftPref = (SwitchPreference) findPreference(KEY_NAVIGATION_BAR_LEFT);
 
@@ -416,6 +421,14 @@ public class ButtonSettings extends SettingsPreferenceFragment implements
                 mNavigationPreferencesCat.removePreference(mNavigationBarLeftPref);
             }
 
+            if (hasNavBar || hardware.isSupported(CMHardwareManager.FEATURE_KEY_DISABLE)) {
+                // Navigation bar height
+                int statusNavButtonsHeight = CMSettings.System.getInt(resolver,
+                        CMSettings.System.NAV_BUTTONS_HEIGHT, 48);
+                mNavButtonsHeight = initActionList(KEY_NAVIGATION_HEIGHT,
+                        statusNavButtonsHeight);
+            }
+
             if (!hasNavBar && (needsNavigationBar ||
                     !hardware.isSupported(CMHardwareManager.FEATURE_KEY_DISABLE))) {
                     // Hide navigation bar category
@@ -623,6 +636,10 @@ public class ButtonSettings extends SettingsPreferenceFragment implements
             Settings.Secure.putInt(getContentResolver(), CAMERA_DOUBLE_TAP_POWER_GESTURE_DISABLED,
                     value ? 0 : 1 /* Backwards because setting is for disabling */);
             return true;
+        } else if (preference == mNavButtonsHeight) {
+            handleActionListChange(mNavButtonsHeight, newValue,
+                    CMSettings.System.NAV_BUTTONS_HEIGHT);
+            return true;
         }
         return false;
     }
-- 
2.7.0

