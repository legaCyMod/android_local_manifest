From 9c261fff8dc9a9e47ec5cc60e5b05361e4719eeb Mon Sep 17 00:00:00 2001
From: Robin Humble <plaguedbypenguins@gmail.com>
Date: Wed, 18 Sep 2013 13:52:58 +1000
Subject: [PATCH 14/15] media: add fm support

Change-Id: If0e5d11c0a2ecc58b37806b28902f8838f7da894
---
 media/java/android/media/AudioManager.java |    5 ++++-
 media/java/android/media/AudioService.java |   12 ++++++++----
 media/java/android/media/AudioSystem.java  |    8 +++++++-
 3 files changed, 19 insertions(+), 6 deletions(-)

diff --git a/media/java/android/media/AudioManager.java b/media/java/android/media/AudioManager.java
index 0060b53..1dcbae7 100644
--- a/media/java/android/media/AudioManager.java
+++ b/media/java/android/media/AudioManager.java
@@ -224,6 +224,8 @@ public class AudioManager {
     public static final int STREAM_TTS = AudioSystem.STREAM_TTS;
     /** @hide The audio stream for incall music delivery */
     public static final int STREAM_INCALL_MUSIC = AudioSystem.STREAM_INCALL_MUSIC;
+    /** @hide The audio stream for legacy FM radio */
+    public static final int STREAM_FM = AudioSystem.STREAM_FM;
     /** Number of audio streams */
     /**
      * @deprecated Use AudioSystem.getNumStreamTypes() instead
@@ -243,7 +245,8 @@ public class AudioManager {
         7,  // STREAM_SYSTEM_ENFORCED
         11, // STREAM_DTMF
         11, // STREAM_TTS
-        4   // STREAM_INCALL_MUSIC
+        4,  // STREAM_INCALL_MUSIC
+        11  // STREAM_FM
     };
 
     /**
diff --git a/media/java/android/media/AudioService.java b/media/java/android/media/AudioService.java
index 4051bf3..3ed0e82 100644
--- a/media/java/android/media/AudioService.java
+++ b/media/java/android/media/AudioService.java
@@ -229,7 +229,8 @@ public class AudioService extends IAudioService.Stub implements OnFinished {
         7,  // STREAM_SYSTEM_ENFORCED
         15, // STREAM_DTMF
         15, // STREAM_TTS
-        15  // STREAM_INCALL_MUSIC
+        15, // STREAM_INCALL_MUSIC
+        15  // STREAM_FM
     };
     /* mStreamVolumeAlias[] indicates for each stream if it uses the volume settings
      * of another stream: This avoids multiplying the volume settings for hidden
@@ -250,7 +251,8 @@ public class AudioService extends IAudioService.Stub implements OnFinished {
         AudioSystem.STREAM_RING,            // STREAM_SYSTEM_ENFORCED
         AudioSystem.STREAM_RING,            // STREAM_DTMF
         AudioSystem.STREAM_MUSIC,           // STREAM_TTS
-        AudioSystem.STREAM_MUSIC            // STREAM_INCALL_MUSIC
+        AudioSystem.STREAM_MUSIC,           // STREAM_INCALL_MUSIC
+        AudioSystem.STREAM_MUSIC            // STREAM_FM
     };
     private final int[] STREAM_VOLUME_ALIAS_NON_VOICE = new int[] {
         AudioSystem.STREAM_VOICE_CALL,      // STREAM_VOICE_CALL
@@ -263,7 +265,8 @@ public class AudioService extends IAudioService.Stub implements OnFinished {
         AudioSystem.STREAM_MUSIC,           // STREAM_SYSTEM_ENFORCED
         AudioSystem.STREAM_MUSIC,           // STREAM_DTMF
         AudioSystem.STREAM_MUSIC,           // STREAM_TTS
-        AudioSystem.STREAM_MUSIC            // STREAM_INCALL_MUSIC
+        AudioSystem.STREAM_MUSIC,           // STREAM_INCALL_MUSIC
+        AudioSystem.STREAM_MUSIC            // STREAM_FM
     };
     private int[] mStreamVolumeAlias;
 
@@ -281,7 +284,8 @@ public class AudioService extends IAudioService.Stub implements OnFinished {
             "STREAM_SYSTEM_ENFORCED",
             "STREAM_DTMF",
             "STREAM_TTS",
-            "STREAM_INCALL_MUSIC"
+            "STREAM_INCALL_MUSIC",
+            "STREAM_FM"
     };
 
     private boolean mLinkNotificationWithVolume;
diff --git a/media/java/android/media/AudioSystem.java b/media/java/android/media/AudioSystem.java
index eacd624..ddf7bf8 100644
--- a/media/java/android/media/AudioSystem.java
+++ b/media/java/android/media/AudioSystem.java
@@ -54,13 +54,15 @@ public class AudioSystem
     public static final int STREAM_TTS = 9;
     /* @hide The audio stream for incall music delivery */
     public static final int STREAM_INCALL_MUSIC = 10;
+    /* @hide The audio stream for FM radio */
+    public static final int STREAM_FM = 11;
     /**
      * @deprecated Use {@link #numStreamTypes() instead}
      */
     public static final int NUM_STREAMS = 5;
 
     // Expose only the getter method publicly so we can change it in the future
-    private static final int NUM_STREAM_TYPES = 11;
+    private static final int NUM_STREAM_TYPES = 12;
     public static final int getNumStreamTypes() { return NUM_STREAM_TYPES; }
 
     /*
@@ -232,6 +234,8 @@ public class AudioSystem
     public static final int DEVICE_OUT_ANC_HEADSET = 0x10000;
     public static final int DEVICE_OUT_ANC_HEADPHONE = 0x20000;
     public static final int DEVICE_OUT_PROXY = 0x40000;
+    public static final int DEVICE_OUT_FM = 0x80000;
+    public static final int DEVICE_OUT_FM_TX = 0x100000;
     public static final int DEVICE_OUT_DEFAULT = DEVICE_BIT_DEFAULT;
 
     public static final int DEVICE_OUT_ALL = (DEVICE_OUT_EARPIECE |
@@ -253,6 +257,8 @@ public class AudioSystem
                                               DEVICE_OUT_ANC_HEADSET |
                                               DEVICE_OUT_ANC_HEADPHONE |
                                               DEVICE_OUT_PROXY |
+                                              DEVICE_OUT_FM |
+                                              DEVICE_OUT_FM_TX |
                                               DEVICE_OUT_DEFAULT);
     public static final int DEVICE_OUT_ALL_A2DP = (DEVICE_OUT_BLUETOOTH_A2DP |
                                                    DEVICE_OUT_BLUETOOTH_A2DP_HEADPHONES |
-- 
1.7.9.5

